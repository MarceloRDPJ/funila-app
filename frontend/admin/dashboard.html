<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funila — Dashboard</title>
    <link rel="icon" href="/frontend/assets/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
</head>
<body>

<div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>

<aside class="sidebar" id="sidebar">
    <div class="brand">FUNILA <span>PRO</span></div>
    <ul class="nav-links">
        <li class="nav-item"><a href="dashboard.html" class="active">
            <i data-lucide="layout-dashboard" class="nav-icon"></i>
            Dashboard
        </a></li>
        <li class="nav-item"><a href="leads.html">
            <i data-lucide="users" class="nav-icon"></i>
            Leads
        </a></li>
        <li class="nav-item"><a href="links.html">
            <i data-lucide="link" class="nav-icon"></i>
            Links
        </a></li>
        <li class="nav-item"><a href="forms.html">
            <i data-lucide="clipboard-list" class="nav-icon"></i>
            Formulário
        </a></li>
    </ul>
    <div class="user-info">
        <button class="logout-btn" onclick="Auth.logout()">
            <i data-lucide="log-out" class="nav-icon" style="width:16px;height:16px"></i>
            Sair
        </button>
    </div>
</aside>

<main class="main-content">
    <div class="page-header">
        <div style="display:flex;align-items:center;gap:12px">
            <button class="mobile-menu-btn" onclick="openSidebar()">
                <i data-lucide="menu"></i>
            </button>
            <h1 class="page-title">Dashboard</h1>
        </div>
        <div style="display:flex;align-items:center;gap:10px">
            <select id="period-filter" onchange="loadDashboard()" style="background:var(--bg-tertiary);border:1px solid var(--border-strong);border-radius:var(--radius-sm);color:var(--text-primary);font-family:var(--font);font-size:.85rem;padding:8px 14px;outline:none;cursor:pointer">
                <option value="today">Hoje</option>
                <option value="week" selected>7 dias</option>
                <option value="month">30 dias</option>
            </select>
        </div>
    </div>

    <div class="page-body">
        <div class="card-grid">
            <div class="card">
                <div class="card-label">Total de Cliques</div>
                <div class="card-value" id="val-clicks">—</div>
            </div>
            <div class="card">
                <div class="card-label">Leads Gerados</div>
                <div class="card-value" id="val-leads">—</div>
            </div>
            <div class="card">
                <div class="card-label">Leads Quentes</div>
                <div class="card-value" id="val-hot" style="color:var(--hot)">—</div>
            </div>
            <div class="card">
                <div class="card-label">Taxa de Conversão</div>
                <div class="card-value" id="val-conv">—%</div>
            </div>
        </div>

        <div class="card" style="margin-bottom:24px;padding:24px 32px 32px">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px">
                <span style="font-size:1rem;font-weight:600;color:var(--text-primary)">Leads por dia</span>
                <span class="text-muted" id="chart-subtitle"></span>
            </div>
            <div style="height:240px;position:relative">
                <canvas id="leadsChart"></canvas>
                <div id="chart-empty" style="display:none;position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:var(--text-muted);font-size:.85rem">Sem dados no período</div>
            </div>
        </div>

        <!-- Funnel Widget -->
        <div class="card" style="margin-bottom:24px;padding:24px 32px 32px">
            <div class="card-label" style="margin-bottom:24px;font-size:0.9rem">Funil de Conversão</div>
            <div class="funnel-container" id="funnel-container" style="display:grid;grid-template-columns:repeat(4, 1fr);gap:16px;text-align:center">
                <!-- Step 1 -->
                <div class="funnel-step">
                    <div class="funnel-count" id="f-step1">—</div>
                    <div class="funnel-label">Visitantes (Etapa 1)</div>
                    <div class="funnel-rate text-muted" id="f-rate1">—</div>
                </div>
                <!-- Step 2 -->
                <div class="funnel-step">
                    <div class="funnel-count" id="f-step2">—</div>
                    <div class="funnel-label">Dados Pessoais (Etapa 2)</div>
                    <div class="funnel-rate text-muted" id="f-rate2">—</div>
                </div>
                <!-- Step 3 -->
                <div class="funnel-step">
                    <div class="funnel-count" id="f-step3">—</div>
                    <div class="funnel-label">Financeiro (Etapa 3)</div>
                    <div class="funnel-rate text-muted" id="f-rate3">—</div>
                </div>
                <!-- Converted -->
                <div class="funnel-step">
                    <div class="funnel-count" id="f-conv" style="color:var(--success)">—</div>
                    <div class="funnel-label">Convertidos</div>
                    <div class="funnel-rate text-muted" id="f-rate4">—</div>
                </div>
            </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
            <div class="card">
                <div class="card-label" style="margin-bottom:20px">Distribuição por status</div>
                <div id="breakdown-list" style="display:flex;flex-direction:column;gap:12px"></div>
            </div>
            <div class="card">
                <div class="card-label" style="margin-bottom:20px">Resumo</div>
                <div id="summary-list" style="display:flex;flex-direction:column;gap:12px"></div>
            </div>
        </div>
    </div>
</main>

<script src="js/auth.js"></script>
<script src="js/dashboard.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        lucide.createIcons();
    });

    function openSidebar() {
        document.getElementById("sidebar").classList.add("open");
        document.getElementById("sidebar-overlay").classList.add("open");
    }
    function closeSidebar() {
        document.getElementById("sidebar").classList.remove("open");
        document.getElementById("sidebar-overlay").classList.remove("open");
    }
</script>
</body>
</html>
